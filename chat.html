<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>ChatGPT-Style Interface</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="src/interface.css" />
  </head>
  <body>
    <!-- Top Navigation -->
    <nav class="navbar is-link" role="navigation" aria-label="main navigation">
      <div class="navbar-brand">
        <a class="navbar-item" href="#">
          <strong>Chat Interface</strong>
        </a>
        <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="sidebarMenu">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
      <div class="navbar-end">
        <div class="navbar-item">
          <button id="theme-toggle" class="button is-light" aria-label="Toggle theme">
            <span class="icon"><i class="fas fa-adjust"></i></span>
          </button>
        </div>
      </div>
    </nav>

    <div class="columns is-gapless chat-layout">
      <!-- Sidebar -->
      <aside class="column is-3 menu sidebar" id="sidebarMenu">
        <div class="menu-container">
          <p class="menu-label">Chats</p>
          <ul class="menu-list" id="chat-list"></ul>
          <div class="menu-actions">
            <a id="new-chat-btn" class="button is-fullwidth is-link">
              <span class="icon"><i class="fas fa-plus"></i></span>
              <span>New chat</span>
            </a>
            <a id="settings-btn" class="button is-fullwidth">
              <span class="icon"><i class="fas fa-cog"></i></span>
              <span>Settings</span>
            </a>
          </div>
        </div>
      </aside>

      <!-- Main Chat Area -->
      <main class="section">
        <div class="container">
          <div class="field is-grouped">
            <div class="control">
              <label class="label" for="model-select">Model:</label>
              <div class="select">
                <select id="model-select"></select>
              </div>
            </div>
            <div class="control" id="instructions-group" style="display: none">
              <label class="label" for="instructions-select">Instructions:</label>
              <div class="select">
                <select id="instructions-select"></select>
              </div>
              <button id="edit-instruction-btn" class="button is-small" style="display: none">
                Edit
              </button>
            </div>
          </div>
          <div id="chat-history" class="content"></div>
          <div class="field has-addons">
            <div class="control is-expanded">
              <textarea
                id="user-input"
                class="textarea"
                placeholder="Send a message..."
                rows="1"
              ></textarea>
            </div>
            <div class="control">
              <button id="send-btn" class="button is-primary">
              <svg width="24" height="24" viewBox="0 0 24 24">
                <path
                  fill="currentColor"
                  d="M2,21L23,12L2,3V10L17,12L2,14V21Z"
                />
              </svg>
            </button>
          </div>
        </div>
      </main>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
      <div class="modal-background"></div>
      <div class="modal-card">
        <header class="modal-card-head">
          <p class="modal-card-title">Settings</p>
          <button id="close-settings" class="delete" aria-label="close"></button>
        </header>
        <section class="modal-card-body">
          <div class="field">
            <label class="label" for="endpoint">Endpoint URL</label>
            <div class="control">
              <input
                class="input"
                type="text"
                id="endpoint"
                placeholder="https://YOUR_RESOURCE_NAME.openai.azure.com"
              />
            </div>
          </div>
          <div class="field">
            <label class="label" for="api-key">API Key</label>
            <div class="control">
              <input 
                class="input" 
                type="password" 
                id="api-key" 
                placeholder="YOUR_API_KEY" 
              />
            </div>
          </div>
          <div class="field">
            <label class="label" for="title-deployment">Title Deployment Name (optional)</label>
            <div class="control">
              <input
                class="input"
                type="text"
                id="title-deployment"
                placeholder="YOUR_TITLE_DEPLOYMENT_NAME"
              />
            </div>
          </div>
        </section>
        <footer class="modal-card-foot">
          <button id="save-settings-btn" class="button is-success">Save Changes</button>
        </footer>
      </div>
    </div>

    <!-- Custom Modal -->
    <div id="custom-modal" class="modal">
      <div class="modal-background"></div>
      <div class="modal-card">
        <header class="modal-card-head">
          <p class="modal-card-title" id="custom-modal-title">Title</p>
          <button id="custom-modal-close" class="delete" aria-label="close"></button>
        </header>
        <section class="modal-card-body" id="custom-modal-body">
          <!-- Message content will be injected here -->
        </section>
        <footer class="modal-card-foot" id="custom-modal-footer">
          <!-- Buttons will be injected here -->
        </footer>
      </div>
    </div>

    <!-- Include Marked.js and DOMPurify via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.7/dist/purify.min.js"></script>

    <!-- Include Instructions -->
    <script src="src/instructions.js"></script>

    <!-- Application Modules -->
    <script src="src/models.js"></script>
    <script src="src/storage.js"></script>
    <script src="src/config.js"></script>
    <script src="src/api.js"></script>
    <script src="src/theme.js"></script>
    <script src="src/chat.js"></script>
    <script src="src/message.js"></script>
    <script src="src/rendering.js"></script>
    <script src="src/events.js"></script>
    <script src="src/modal.js"></script>
    <script src="src/controller.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        ControllerModule.initializeApp();
      });
    </script>
  </body>
</html>
